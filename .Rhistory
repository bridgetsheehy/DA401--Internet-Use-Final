)
pred_grid$wwwhr_hat <- predict(model_year_sex, newdata = pred_grid, type = "response")
library(ggplot2)
ggplot(pred_grid, aes(x = year, y = wwwhr_hat, color = sex)) +
geom_line(linewidth = 1.2) +
theme_minimal() +
labs(x = "Year", y = "Predicted Internet Use (hours)", title = "Predicted Internet Use by Year and Sex",
color = "Sex"
) +
scale_color_discrete(labels = c("Female", "Male"))
ggsave("predicted_wwwhr_by_year_and_sex.png",
width = 7, height = 5, dpi = 300)
# Poisson model with AGE x SEX
model_age_sex <- glm(wwwhr ~ age * sex,
family = poisson(link = "log"),
data = plot_data)
# Prediction grid: AGE on x-axis, separate lines by sex
pred_grid <- expand.grid(
age = seq(min(plot_data$age, na.rm = TRUE), max(plot_data$age, na.rm = TRUE)),
sex = levels(plot_data$sex)
)
# Predicted mean wwwhr (response scale)
pred_grid$wwwhr_hat <- predict(model_age_sex, newdata = pred_grid, type = "response")
library(ggplot2)
ggplot(pred_grid, aes(x = age, y = wwwhr_hat, color = sex)) +
geom_line(linewidth = 1.2) +
theme_minimal() +
labs(
x = "Age",
y = "Predicted Internet Use (hours)",
title = "Predicted Internet Use by Age and Sex",
color = "Sex"
) +
scale_color_discrete(labels = c("Female", "Male"))
ggsave("predicted_wwwhr_by_age_and_sex.png",
width = 7, height = 5, dpi = 300)
#Read in cleaned data
GSSData <- readRDS("GSS-Raw.rds")
#converting factors
GSSData$sex     <- factor(GSSData$sex)
GSSData$race    <- factor(GSSData$race)
GSSData$region  <- factor(GSSData$region)
GSSData$wrkstat <- factor(GSSData$wrkstat)
#year fixed effects factor
GSSData$year <- factor(GSSData$year)
#drop na's
GSSModel <- subset(GSSData, !is.na(wwwhr))
#Poisson Regression
model_pois <- glm(
wwwhr ~ age + educ + sex + race + region + wrkstat + year,
data   = GSSModel,
family = poisson(link = "log")
)
summary(model_pois)
#Coefficient Plot
library(broom)
library(ggplot2)
coef_df <- broom::tidy(model_pois, conf.int = TRUE)
ggplot(coef_df, aes(x = estimate, y = term)) +
geom_point() +
geom_errorbarh(aes(xmin = conf.low, xmax = conf.high), height = 0.2) +
theme_minimal() +
labs(title = "Poisson Regression Coefficient Plot",
x = "Estimate (log scale)", y = "")
#Residual Plot
res_df <- data.frame(
fitted = fitted(model_pois),
residuals = residuals(model_pois, type = "deviance")
)
ggplot(res_df, aes(x = fitted, y = residuals)) +
geom_point(alpha = 0.3) +
geom_hline(yintercept = 0, color = "red") +
theme_minimal() +
labs(title = "Residuals vs Fitted Values",
x = "Fitted Values",
y = "Deviance Residuals")
# MASON CODE HERE:
# Checking for overdispersion... if the mean of your D.V. > the variance of your D.V., this is called "overdispersion"
# and can deflate your standard errors/ inflate your z/t values.
mean(GSSModel$wwwhr) # mean = 11.1
var(GSSModel$wwwhr) # variance = 232.4
# Looks like overdisperion is present, but to check for sure, you can run the code below (small p-value for the test below indicates
# overdispersion is present)
# To formally check
install.packages("AER")
library(AER)
dispersiontest(model_pois)
# p <.00001 ... definitely overdispersion.
# Because of this, you'll want to run a Quasi-Poisson model rather than the regular Poisson model. This quasi version relaxes the assumption that the mean = the variance. You'll notice that your coefficient estimates will be the exact same as your original model... The change is that it will result in larger standard errors, but will be more reliable than the regular version.
model_qpois <- glm(
wwwhr ~ age + educ + sex + race + region + wrkstat + year,
data   = GSSModel,
family = quasipoisson(link = "log")
)
summary(model_qpois)
# IF you want to change your reference group for year, run this code, and THEN re-run your model
#GSSModel$year <- relevel(GSSModel$year, ref = "2002")
# MASON CODE HERE:
# Checking for overdispersion... if the mean of your D.V. > the variance of your D.V., this is called "overdispersion"
# and can deflate your standard errors/ inflate your z/t values.
mean(GSSModel$wwwhr) # mean = 11.1
var(GSSModel$wwwhr) # variance = 232.4
# Looks like overdisperion is present, but to check for sure, you can run the code below (small p-value for the test below indicates
# overdispersion is present)
# To formally check
#install.packages("AER")
library(AER)
dispersiontest(model_pois)
# p <.00001 ... definitely overdispersion.
# Because of this, you'll want to run a Quasi-Poisson model rather than the regular Poisson model. This quasi version relaxes the assumption that the mean = the variance. You'll notice that your coefficient estimates will be the exact same as your original model... The change is that it will result in larger standard errors, but will be more reliable than the regular version.
model_qpois <- glm(
wwwhr ~ age + educ + sex + race + region + wrkstat + year,
data   = GSSModel,
family = quasipoisson(link = "log")
)
summary(model_qpois)
# IF you want to change your reference group for year, run this code, and THEN re-run your model
#GSSModel$year <- relevel(GSSModel$year, ref = "2002")
#Read in cleaned data
GSSData <- readRDS("GSS-Raw.rds")
#converting factors
GSSData$sex     <- factor(GSSData$sex)
GSSData$race    <- factor(GSSData$race)
GSSData$region  <- factor(GSSData$region)
GSSData$wrkstat <- factor(GSSData$wrkstat)
#year fixed effects factor
GSSData$year <- factor(GSSData$year)
#drop na's
GSSModel <- subset(GSSData, !is.na(wwwhr))
#Poisson Regression
model_pois <- glm(
wwwhr ~ age + educ + sex + race + region + wrkstat + year,
data   = GSSModel,
family = poisson(link = "log")
)
summary(model_pois)
# MASON CODE HERE:
# Checking for overdispersion... if the mean of your D.V. > the variance of your D.V., this is called "overdispersion"
# and can deflate your standard errors/ inflate your z/t values.
mean(GSSModel$wwwhr) # mean = 11.1
var(GSSModel$wwwhr) # variance = 232.4
# Looks like overdisperion is present, but to check for sure, you can run the code below (small p-value for the test below indicates
# overdispersion is present)
# To formally check
#install.packages("AER")
library(AER)
dispersiontest(model_pois)
# p <.00001 ... definitely overdispersion.
# Because of this, you'll want to run a Quasi-Poisson model rather than the regular Poisson model. This quasi version relaxes the assumption that the mean = the variance. You'll notice that your coefficient estimates will be the exact same as your original model... The change is that it will result in larger standard errors, but will be more reliable than the regular version.
model_qpois <- glm(
wwwhr ~ age + educ + sex + race + region + wrkstat + year,
data   = GSSModel,
family = quasipoisson(link = "log")
)
summary(model_qpois)
# IF you want to change your reference group for year, run this code, and THEN re-run your model
#GSSModel$year <- relevel(GSSModel$year, ref = "2002")
plot_data <- GSSModel[!is.na(GSSModel$sex), ]
plot_data$year <- as.numeric(as.character(plot_data$year))
model_year_sex <- glm(wwwhr ~ year * sex,
family = poisson(link = "log"),
data = plot_data)
pred_grid <- expand.grid(
year = seq(min(plot_data$year), max(plot_data$year)),
sex  = levels(plot_data$sex)
)
pred_grid$wwwhr_hat <- predict(model_year_sex, newdata = pred_grid, type = "response")
library(ggplot2)
ggplot(pred_grid, aes(x = year, y = wwwhr_hat, color = sex)) +
geom_line(linewidth = 1.2) +
theme_minimal() +
labs(x = "Year", y = "Predicted Internet Use (hours)", title = "Predicted Internet Use by Year and Sex",
color = "Sex"
) +
scale_color_discrete(labels = c("Female", "Male"))
ggsave("predicted_wwwhr_by_year_and_sex.png",
width = 7, height = 5, dpi = 300)
# Poisson model with AGE x SEX
model_age_sex <- glm(wwwhr ~ age * sex,
family = poisson(link = "log"),
data = plot_data)
# Prediction grid: AGE on x-axis, separate lines by sex
pred_grid <- expand.grid(
age = seq(min(plot_data$age, na.rm = TRUE), max(plot_data$age, na.rm = TRUE)),
sex = levels(plot_data$sex)
)
# Predicted mean wwwhr (response scale)
pred_grid$wwwhr_hat <- predict(model_age_sex, newdata = pred_grid, type = "response")
library(ggplot2)
ggplot(pred_grid, aes(x = age, y = wwwhr_hat, color = sex)) +
geom_line(linewidth = 1.2) +
theme_minimal() +
labs(
x = "Age",
y = "Predicted Internet Use (hours)",
title = "Predicted Internet Use by Age and Sex",
color = "Sex"
) +
scale_color_discrete(labels = c("Female", "Male"))
ggsave("predicted_wwwhr_by_age_and_sex.png",
width = 7, height = 5, dpi = 300)
plot_data <- GSSModel[!is.na(GSSModel$sex), ]
plot_data$year <- as.numeric(as.character(plot_data$year))
model_year_sex <- glm(wwwhr ~ year * sex,
family = poisson(link = "log"),
data = plot_data)
pred_grid <- expand.grid(
year = seq(min(plot_data$year), max(plot_data$year)),
sex  = levels(plot_data$sex)
)
pred_grid$wwwhr_hat <- predict(model_year_sex, newdata = pred_grid, type = "response")
library(ggplot2)
ggplot(pred_grid, aes(x = year, y = wwwhr_hat, color = sex)) +
geom_line(linewidth = 1.2) +
theme_minimal() +
labs(x = "Year", y = "Predicted Internet Use (hours)", title = "Predicted Internet Use by Year and Sex",
color = "Sex"
) +
scale_color_discrete(labels = c("Male", "Female"))
ggsave("predicted_wwwhr_by_year_and_sex.png",
width = 7, height = 5, dpi = 300)
# Poisson model with AGE x SEX
model_age_sex <- glm(wwwhr ~ age * sex,
family = poisson(link = "log"),
data = plot_data)
# Prediction grid: AGE on x-axis, separate lines by sex
pred_grid <- expand.grid(
age = seq(min(plot_data$age, na.rm = TRUE), max(plot_data$age, na.rm = TRUE)),
sex = levels(plot_data$sex)
)
# Predicted mean wwwhr (response scale)
pred_grid$wwwhr_hat <- predict(model_age_sex, newdata = pred_grid, type = "response")
library(ggplot2)
ggplot(pred_grid, aes(x = age, y = wwwhr_hat, color = sex)) +
geom_line(linewidth = 1.2) +
theme_minimal() +
labs(
x = "Age",
y = "Predicted Internet Use (hours)",
title = "Predicted Internet Use by Age and Sex",
color = "Sex"
) +
scale_color_discrete(labels = c("Male", "Female"))
ggsave("predicted_wwwhr_by_age_and_sex.png",
width = 7, height = 5, dpi = 300)
# Poisson model with AGE x SEX
model_age_sex <- glm(wwwhr ~ age * sex,
family = poisson(link = "log"),
data = plot_data)
# Prediction grid: AGE on x-axis, separate lines by sex
pred_grid <- expand.grid(
age = seq(min(plot_data$age, na.rm = TRUE), max(plot_data$age, na.rm = TRUE)),
sex = levels(plot_data$sex)
)
# Predicted mean wwwhr (response scale)
pred_grid$wwwhr_hat <- predict(model_age_sex, newdata = pred_grid, type = "response")
library(ggplot2)
ggplot(pred_grid, aes(x = age, y = wwwhr_hat, color = sex)) +
geom_line(linewidth = 1.2) +
theme_minimal() +
labs(
x = "Age",
y = "Predicted Internet Use (hours)",
title = "Predicted Internet Use by Age and Sex",
color = "Sex"
) + scale_color_manual(values = c("Male" = "#0072B2", "Female" = "#D55E00"))+
scale_color_discrete(labels = c("Male", "Female"))
ggsave("predicted_wwwhr_by_age_and_sex.png",
width = 7, height = 5, dpi = 300)
# Poisson model with AGE x SEX
model_age_sex <- glm(wwwhr ~ age * sex,
family = poisson(link = "log"),
data = plot_data)
# Prediction grid: AGE on x-axis, separate lines by sex
pred_grid <- expand.grid(
age = seq(min(plot_data$age, na.rm = TRUE), max(plot_data$age, na.rm = TRUE)),
sex = levels(plot_data$sex)
)
# Predicted mean wwwhr (response scale)
pred_grid$wwwhr_hat <- predict(model_age_sex, newdata = pred_grid, type = "response")
library(ggplot2)
ggplot(pred_grid, aes(x = age, y = wwwhr_hat, color = sex)) +
geom_line(linewidth = 1.2) +
theme_minimal() +
labs(
x = "Age",
y = "Predicted Internet Use (hours)",
title = "Predicted Internet Use by Age and Sex",
color = "Sex"
) +
scale_color_discrete(labels = c("Male", "Female"))
ggsave("predicted_wwwhr_by_age_and_sex.png",
width = 7, height = 5, dpi = 300)
# Poisson model with AGE x SEX
model_age_sex <- glm(wwwhr ~ age * sex,
family = poisson(link = "log"),
data = plot_data)
# Prediction grid: AGE on x-axis, separate lines by sex
pred_grid <- expand.grid(
age = seq(min(plot_data$age, na.rm = TRUE), max(plot_data$age, na.rm = TRUE)),
sex = levels(plot_data$sex)
)
# Predicted mean wwwhr (response scale)
pred_grid$wwwhr_hat <- predict(model_age_sex, newdata = pred_grid, type = "response")
library(ggplot2)
ggplot(pred_grid, aes(x = age, y = wwwhr_hat, color = sex)) +
geom_line(linewidth = 1.2) +
theme_minimal() +
labs(
x = "Age",
y = "Predicted Internet Use (hours)",
title = "Predicted Internet Use by Age and Sex",
color = "Sex"
) +
scale_color_manual(values = c("Male" = "#D55E00", "Female" = "#0072B2")
)
ggsave("predicted_wwwhr_by_age_and_sex.png",
width = 7, height = 5, dpi = 300)
# Poisson model with AGE x SEX
model_age_sex <- glm(wwwhr ~ age * sex,
family = poisson(link = "log"),
data = plot_data)
# Prediction grid: AGE on x-axis, separate lines by sex
pred_grid <- expand.grid(
age = seq(min(plot_data$age, na.rm = TRUE), max(plot_data$age, na.rm = TRUE)),
sex = levels(plot_data$sex)
)
# Predicted mean wwwhr (response scale)
pred_grid$wwwhr_hat <- predict(model_age_sex, newdata = pred_grid, type = "response")
library(ggplot2)
ggplot(pred_grid, aes(x = age, y = wwwhr_hat, color = sex)) +
geom_line(linewidth = 1.2) +
theme_minimal() +
labs(
x = "Age",
y = "Predicted Internet Use (hours)",
title = "Predicted Internet Use by Age and Sex",
color = "Sex"
) +
scale_color_manual(values = c("Male" = "blue", "Female" = "red"))
ggsave("predicted_wwwhr_by_age_and_sex.png",
width = 7, height = 5, dpi = 300)
model_year_sex <- glm(wwwhr ~ year * sex,
family = poisson(link = "log"),
data = plot_data)
pred_grid <- expand.grid(
year = seq(min(plot_data$year), max(plot_data$year)),
sex  = levels(plot_data$sex)
)
pred_grid$wwwhr_hat <- predict(model_year_sex, newdata = pred_grid, type = "response")
library(ggplot2)
ggplot(pred_grid, aes(x = year, y = wwwhr_hat, color = sex)) +
geom_line(linewidth = 1.2) +
theme_minimal() +
labs(x = "Year", y = "Predicted Internet Use (hours)", title = "Predicted Internet Use by Year and Sex",
color = "Sex"
) +
scale_color_discrete(labels = c("Male", "Female"))
ggsave("predicted_wwwhr_by_year_and_sex.png",
width = 7, height = 5, dpi = 300)
# Poisson model with AGE x SEX
model_age_sex <- glm(wwwhr ~ age * sex,
family = poisson(link = "log"),
data = plot_data)
# Prediction grid: AGE on x-axis, separate lines by sex
pred_grid <- expand.grid(
age = seq(min(plot_data$age, na.rm = TRUE), max(plot_data$age, na.rm = TRUE)),
sex = levels(plot_data$sex)
)
# Predicted mean wwwhr (response scale)
pred_grid$wwwhr_hat <- predict(model_age_sex, newdata = pred_grid, type = "response")
library(ggplot2)
ggplot(pred_grid, aes(x = age, y = wwwhr_hat, color = sex)) +
geom_line(linewidth = 1.2) +
theme_minimal() +
labs(
x = "Age",
y = "Predicted Internet Use (hours)",
title = "Predicted Internet Use by Age and Sex",
color = "Sex"
) +
scale_color_discrete(labels = c("Male", "Female"))
ggsave("predicted_wwwhr_by_age_and_sex.png",
width = 7, height = 5, dpi = 300)
#Read in cleaned data
GSSData <- readRDS("GSS-Raw.rds")
#converting factors
GSSData$sex     <- factor(GSSData$sex)
GSSData$race    <- factor(GSSData$race)
GSSData$region  <- factor(GSSData$region)
GSSData$wrkstat <- factor(GSSData$wrkstat)
#year fixed effects factor
GSSData$year <- factor(GSSData$year)
#drop na's
GSSModel <- subset(GSSData, !is.na(wwwhr))
#Poisson Regression
model_pois <- glm(
wwwhr ~ age + educ + sex + race + region + wrkstat + year,
data   = GSSModel,
family = poisson(link = "log")
)
summary(model_pois)
modelsummary(model_pois, output = "model_pois.docx")
#Read in cleaned data
GSSData <- readRDS("GSS-Raw.rds")
#converting factors
GSSData$sex     <- factor(GSSData$sex)
GSSData$race    <- factor(GSSData$race)
GSSData$region  <- factor(GSSData$region)
GSSData$wrkstat <- factor(GSSData$wrkstat)
#year fixed effects factor
GSSData$year <- factor(GSSData$year)
#drop na's
GSSModel <- subset(GSSData, !is.na(wwwhr))
library(modelsummary)
install.packages("modelsummary")
#Poisson Regression
model_pois <- glm(
wwwhr ~ age + educ + sex + race + region + wrkstat + year,
data   = GSSModel,
family = poisson(link = "log")
)
summary(model_pois)
capture.output(
print(summary(model_pois)),
file = "model_pois.html"
)
#Poisson Regression
model_pois <- glm(
wwwhr ~ age + educ + sex + race + region + wrkstat + year,
data   = GSSModel,
family = poisson(link = "log")
)
summary(model_pois)
write_xlsx(coef_df, "poisson_model_summary.xlsx")
#Poisson Regression
model_pois <- glm(
wwwhr ~ age + educ + sex + race + region + wrkstat + year,
data   = GSSModel,
family = poisson(link = "log")
)
summary(model_pois)
library(writexl)
write_xlsx(coef_df, "poisson_model_summary.xlsx")
#Poisson Regression
model_pois <- glm(
wwwhr ~ age + educ + sex + race + region + wrkstat + year,
data   = GSSModel,
family = poisson(link = "log")
)
summary(model_pois)
#Save model
model_summary <- summary(model_pois)
coef_df <- as.data.frame(model_summary$coefficients)
# Add variable names as a column
coef_df$Variable <- rownames(coef_df)
rownames(coef_df) <- NULL
library(writexl)
write_xlsx(coef_df, "poisson_model_summary.xlsx")
#Read in cleaned data
GSSData <- readRDS("GSS-Raw.rds")
#converting factors
GSSData$sex     <- factor(GSSData$sex)
GSSData$race    <- factor(GSSData$race)
GSSData$region  <- factor(GSSData$region)
GSSData$wrkstat <- factor(GSSData$wrkstat)
#year fixed effects factor
GSSData$year <- factor(GSSData$year)
#drop na's
GSSModel <- subset(GSSData, !is.na(wwwhr))
#Poisson Regression
model_pois <- glm(
wwwhr ~ age + educ + sex + race + region + wrkstat + year,
data   = GSSModel,
family = poisson(link = "log")
)
summary(model_pois)
#Save as excel
model_summary <- summary(model_pois)
coef_df <- as.data.frame(model_summary$coefficients)
# Add variable names as a column
coef_df$Variable <- rownames(coef_df)
rownames(coef_df) <- NULL
library(writexl)
write_xlsx(coef_df, "poisson_model_summary.xlsx")
# MASON CODE HERE:
# Checking for overdispersion... if the mean of your D.V. > the variance of your D.V., this is called "overdispersion"
# and can deflate your standard errors/ inflate your z/t values.
mean(GSSModel$wwwhr) # mean = 11.1
var(GSSModel$wwwhr) # variance = 232.4
# Looks like overdisperion is present, but to check for sure, you can run the code below (small p-value for the test below indicates
# overdispersion is present)
# To formally check
#install.packages("AER")
library(AER)
dispersiontest(model_pois)
# p <.00001 ... definitely overdispersion.
# Because of this, you'll want to run a Quasi-Poisson model rather than the regular Poisson model. This quasi version relaxes the assumption that the mean = the variance. You'll notice that your coefficient estimates will be the exact same as your original model... The change is that it will result in larger standard errors, but will be more reliable than the regular version.
model_qpois <- glm(
wwwhr ~ age + educ + sex + race + region + wrkstat + year,
data   = GSSModel,
family = quasipoisson(link = "log")
)
summary(model_qpois)
#save as excel
qpois_summary <- summary(model_qpois)
qpois_coef_df <- as.data.frame(qpois_summary$coefficients)
# Add variable names as a column
qpois_coef_df$Variable <- rownames(qpois_coef_df)
rownames(qpois_coef_df) <- NULL
library(writexl)
write_xlsx(qpois_coef_df, "quasipoisson_model_summary.xlsx")
